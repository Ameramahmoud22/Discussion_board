{% extends 'base.html' %}

{% block title %}{{ board.name }}{% endblock %}

{% block header %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent mb-0">
            <li class="breadcrumb-item">
                <a href="{% url 'home' %}" class="text-decoration-none text-secondary">Boards</a>
            </li>
            <li class="breadcrumb-item active fw-bold" aria-current="page">
                {{ board.name }}
            </li>
        </ol>
    </nav>
</div>
<div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
    <h1 class="h3 mb-0 text-dark">{{ board.name }}</h1>
    <a href="{% url 'new_topic' board.pk %}" class="btn btn-primary btn-sm shadow-sm">
        Start New Topic
    </a>
</div>
{% endblock %}

{% block content %}
<p class="text-muted small">
    Total topics: **{{ board.topics.count }}**
</p>

<div class="table-responsive">
    <table class="table table-striped table-hover align-middle shadow-sm rounded overflow-hidden">
        <thead class="table-dark">
            <tr>
                <th scope="col" class="py-2">Topic</th>
                <th scope="col" class="py-2 text-center">Created By</th>
                <th scope="col" class="py-2 text-center">Posts</th>
                <th scope="col" class="py-2 text-center">Views</th>
                <th scope="col" class="py-2">Created dt</th>
            </tr>
        </thead>

        <tbody>
            {% for topic in board.topics.all %}
            <tr class="align-middle">
                <td class="col-6">
                    <a href="{% url 'topic_posts' board.pk topic.pk %}" class="fw-bold text-decoration-none text-dark">{{ topic.subject }}</a>
                    
                    {% comment %} Display last reply info using standard Django date filter {% endcomment %}
                    {% with last_post=topic.posts.last %}
                        {% if last_post and last_post.created_by != topic.created_by %}
                            <p class="small text-muted mb-0 mt-1">
                                Latest: **{{ last_post.created_by.username }}** ({{ last_post.created_dt|date:"P, M j" }})
                            </p>
                        {% endif %}
                    {% endwith %}
                </td>

                <td class="text-center">
                    <span class="badge text-bg-secondary">{{ topic.created_by.username }}</span>
                </td>

                <td class="text-center fw-bold">
                    {# Calculate replies: total posts minus the initial topic post #}
                    {{ topic.posts.count|add:-1 }}
                </td>

                <td class="text-center text-muted">
                    {{ topic.views|default:0 }}
                </td>

                <td class="small text-muted">
                    {{ topic.created_dt|date:"M d, Y" }} <br>
                    <span class="text-secondary">{{ topic.created_dt|date:"P" }}</span>
                </td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center py-4 text-muted">
                    There are no topics here yet. Click "Start New Topic" to begin the discussion!
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}